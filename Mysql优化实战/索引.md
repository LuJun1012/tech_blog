# 索引
#### 事物回滚日志的删除
* 当没有事务再需要用到这些回滚日志时，回滚日志会被删除。

#### 长事物
* 这个事务提交之前，数据库里面它可能用到的回滚记录都必须保留，这就会导致大量占用存储空间。
* 长事务还占用锁资源，也可能拖垮整个库
* set autocommit=1

#### 怎么避免长事物

##### 开发端
* 确认是否使用了set autocommit=1。
* 确认是否有不必要的只读事务。
* 通过 SET MAX_EXECUTION_TIME 命令，来控制每个语句执行的最长时间，避免单个语句意外执行太长时间。

##### 数据库端
* 监控 information_schema.Innodb_trx 表，设置长事务阈值，超过就报警 / 或者 kill；
* Percona 的 pt-kill
* 在业务功能测试阶段要求输出所有的 general_log，分析日志行为提前发现问题；

#### 自增主键的好处
* 每次插入一条新记录，都是追加操作，都不涉及到挪动其他记录，也不会触发叶子节点的分裂。
* 业务逻辑的字段做主键，则往往不容易保证有序插入，这样写数据成本相对较高
* 插入数据如果是在某个数据满了页的首尾，为了减少数据移动和页分裂，会先去前后两个页看看是否满了，如果没满会先将数据放到前后两个页上

#### 适合业务字段直接做主键的
* 只有一个索引
* 该索引必须是唯一索引

#### Page内部定位行数据
* 内部有个有序数组，二分法

#### 最左前缀原则
* 最左前缀可以是联合索引的最左 N 个字段，也可以是字符串索引的最左 M 个字符

#### 索引下推
* 在二级索引中进行条件判断，无须从主键索引中回表拿到数据再进行判断
* 