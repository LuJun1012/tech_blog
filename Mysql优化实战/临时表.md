# 临时表
#### 内存表和临时表区别
* 内存表，指的是使用 Memory 引擎的表，建表语法是 create table … engine=memory。这种表的数据都保存在内存里，系统重启的时候会被清空，但是表结构还在
* 而临时表，可以使用各种引擎类型 。如果是使用 InnoDB 引擎或者 MyISAM 引擎的临时表，写数据的时候是写到磁盘上的。当然，临时表也可以使用 Memory 引擎

#### 临时表特点
* 建表语法是 create temporary table …。
* 一个临时表只能被创建它的 session 访问，对其他线程不可见。所以，图中 session A 创建的临时表 t，对于 session B 就是不可见的。
* 临时表可以与普通表同名。
* session A 内有同名的临时表和普通表的时候，show create 语句，以及增删改查语句访问的是临时表。
* show tables 命令不显示临时表。

#### 临时表存储
* 文件名的后缀是.frm，前缀是“#sql{进程 id}_{线程 id}_ 序列号”
* MySQL 引入了一个临时文件表空间，专门用来存放临时文件的数据。因此，我们就不需要再创建 ibd 文件了。
* 临时表库名+表名+server_id+thread_id

#### 主从同步
* 创建临时表的语句会传到备库执行，因此备库的同步线程就会创建这个临时表。主库在线程退出的时候，会自动删除临时表，但是备库同步线程是持续在运行的。所以，这时候我们就需要在主库上再写一个 DROP TEMPORARY TABLE 传给备库执行。
* 果执行 drop table t_normal，系统记录 binlog 就会写成：

```
DROP TABLE `t_normal` /* generated by server */
```
* 从库区别主库同名临时通过server_id+thread_id+database+table

#### 总结
* 在 binlog_format='row’的时候，临时表的操作不记录到 binlog 中，也省去了不少麻烦
* 