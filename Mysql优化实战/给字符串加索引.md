# 给字符串加索引
#### 索引查询区别
* 完整索引，从索引树找到满足索引值的记录，取得主键的值，然后从主键上查询主键值相匹配的行，判断索引字段是否正确，将记录加入结果集
* 继续查找索引树，直到记录不满足为止
* 使用前缀索引，定义好长度，就可以做到既节省空间，又不用额外增加太多的查询成本。

#### 前缀索引
* distinct left(key, len)
* 前缀索引很可能会损失区分度，需要预先设定一个可以接受的损失比例
```
explain select ID,email from SUser where email='zhangssxyz@xxx.com';
  explain select ID,email from SUser force index(index2) where email='zhangssxyz@xxx.com' ;
```
* 前缀索引就用不上覆盖索引对查询性能的优化了, 因为系统并不确定前缀索引的定义是否截断了完整信息。

#### 优化策略
* 第一种方式是使用倒序存储
* 第二种方式是使用 hash 字段

#### 倒序存储和哈希存储的区别
* 从占用的额外空间来看，倒序存储方式在主键索引上，不会消耗额外的存储空间，而 hash 字段方法需要增加一个字段。
* 在 CPU 消耗方面，倒序方式每次写和读的时候，都需要额外调用一次 reverse 函数，而 hash 字段的方式需要额外调用一次 crc32() 函数
* 从查询效率上看，使用 hash 字段方式的查询性能相对更稳定一些。因为 crc32 算出来的值虽然有冲突的概率，但是概率非常小，可以认为每次查询的平均扫描行数接近 1。而倒序存储方式毕竟还是用的前缀索引的方式，也就是说还是会增加扫描行数
